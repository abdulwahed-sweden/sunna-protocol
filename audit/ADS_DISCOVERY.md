# ADS (Asymmetric Deficit Socialization) — Discovery Report

**Author:** Abdulwahed Mansour

---

## Discovery

Asymmetric Deficit Socialization (ADS) is a vulnerability class discovered by
Abdulwahed Mansour affecting major DeFi lending and yield protocols. ADS occurs when
protocol fee mechanisms extract value during periods of unrealized loss, socializing
the resulting deficit asymmetrically onto depositors.

---

## Total Exposure

**Estimated total exposure: $98.6M+ across affected protocols.**

| Protocol       | Estimated Exposure | Share   |
|----------------|--------------------|---------|
| Aave V3/V4     | ~$96,000,000       | 97.3%   |
| Morpho Blue    | ~$2,000,000        | 2.0%    |
| Curve crvUSD   | ~$585,000          | 0.6%    |

---

## Root Cause

The root cause of ADS is **fee extraction during unrealized loss periods**.

In a healthy state, protocol fees are extracted from yield generated by deployed capital.
However, when the underlying assets experience unrealized losses, the yield calculations
may still report positive returns at the fee layer. This creates a situation where:

1. **Total assets** drop below **total liabilities** (including owed deposits).
2. **Fee extraction** continues based on gross yield, ignoring the net loss.
3. **Depositors** absorb the full deficit when they withdraw.
4. **Fee recipients** retain extracted fees without sharing the loss.

This violates the principle of **Ghunm bil-Ghurm** (gain with risk) and creates a
moral hazard where fee recipients profit regardless of actual protocol performance.

---

## Attack Vector

ADS is not a traditional exploit requiring a malicious actor. It is a **structural
vulnerability** embedded in fee calculation logic:

```
Vulnerable Pattern:
    fee = grossYield × feeRate
    treasury += fee                  // Fee extracted
    // No check: is totalAssets >= totalLiabilities?

Correct Pattern (Sunna Protocol):
    IF totalAssets < totalLiabilities:
        fee = 0                      // PY-1 enforcement
    ELSE:
        fee = realizedProfit × feeRate
        treasury += fee
```

---

## Affected Protocols

### Aave V3/V4 (~$96M, 97.3% of total)

Aave's reserve factor and treasury fee mechanisms continue extracting fees from
accrued interest even when the reserve's total value (including bad debt and
unrealized losses) is below total deposits. See `AAVE_ANALYSIS.md` for details.

### Morpho Blue (~$2M, 2.0% of total)

Morpho Blue's fee model extracts performance fees from vault yield without
cross-referencing the vault's net asset position against total liabilities.
See `MORPHO_ANALYSIS.md` for details.

### Curve crvUSD (~$585K, 0.6% of total)

Curve's crvUSD minting and fee mechanisms have a smaller but measurable exposure
to ADS through interest rate spread extraction during periods of collateral
depreciation.

---

## Sunna Protocol Solution

The Sunna Protocol eliminates ADS through:

1. **PY-1 Invariant:** `ΔTreasury ≡ 0 IF ΔLoss > 0` — no fees during losses.
2. **SE-1 Invariant:** `totalAssets ≥ totalLiabilities` — enforced on every tx.
3. **TakafulBuffer:** Fees escrowed until solvency confirmed.
4. **SD-1 Invariant:** Fee recipients share proportional losses.

---

*Last updated: 2026-02-22*
